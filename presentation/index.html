<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Can you trust your tests?</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/tomorrow-night.css">

    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
      if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
      }
    </script>
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <section data-markdown>
          <script type="text/template">
            # Can you trust your tests?

            <img src="./images/vilnius-rb.png" width=160
              style="margin: 80px 10px -20px 0"/>
            <span class="who">
              2015 Tadas Ščerbinskas & Vaidas Pilkauskas
            </span>
          </script>
        </section>

        <section>
          <div>
            <div class="box left">
              Tadas Ščerbinskas
              @tadassce
            </div>
            <div class="box right">
              Vaidas Pilkauskas
              @liucijus
            </div>
          </div>
        </section>

        <section data-markdown>
          <script type="text/template">
            ## Agenda
            * Test code quality
            * Mutation testing
            * Mutant - mutation testing for Ruby
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Prod vs. Test code quality

            Code has bugs.<br>
            Tests are code.<br>
            Tests have bugs.
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Prod vs. Test code quality

            Code has bugs.<br>
            Tests are code.<br>
            Tests have bugs.
          </script>
        </section>

        <section data-background="./images/who_watches_the_watchmen.jpg">
        </section>

        <section data-markdown>
          <script type="text/template">
            <aside class="notes">
             should discuss two aspects: test specification and code quality,
             list is only of test specification qualifiers
            </aside>

            ### Test Quality
            * Readable
            * Focused
            * Concise
            * Well named

          </script>
        </section>

        <section data-markdown class="coverage">
          <script type="text/template">
            > "Program testing can be used to show the presence of bugs, but never to show their absence!"
            <br>
            <a>- Edsger W. Dijkstra</a>
          </script>
        </section>

        <section data-markdown data-background="./images/monkey.jpg">
          <script type="text/template">
            <!-- http://www.chimpsanctuarynw.org/blog/wp-content/uploads/2009/03/negra-covered-in-pink-blanket-front-room_web_mg_8161.jpg -->
            ### Code coverage
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Types of code coverage
            * Line
            * Branch
            * Condition
            * Path
            * Data
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Coverage tool for Ruby
            simplecov
            ```
            gem install simplecov
            ```
            ```ruby
            require 'simplecov'
            SimpleCov.start
            ```
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Line

            ```ruby
            def foo(arg = true)
              arg ? "a" : "b"
            end
            ```

            ```ruby
            expect(foo).to eq "a"
            ```

            100% line coverage. No test for "b".
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Branch

            ```ruby
            def foo(arg)
              arg ? "a" : "b"
            end
            ```

            ```ruby
            expect(foo(true)).to eq "a"
            expect(foo(false)).to eq "b"
            ```

            100% branch coverage
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            # Demo
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Can you trust 100% coverage?
            * Code coverage can only show what is *not* tested
            * 100% code coverage for interpreted languages is kind of like full compilation
          </script>
        </section>

        <section data-markdown data-background="./images/all_tests_pass.jpg">
          <!-- https://twitter.com/bloerwald/status/448415935926255618 -->
          <script type="text/template">
            #### SUCCESS: 26/26 (100%) Tests passed
          </script>
        </section>

        <section data-background="./images/crowrilla.jpg">
          <h3 style="color: #e7ad52">
            Mutation testing
          </h3>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Mutation testing
            Changes your program code and<br>
            expects your tests to fail.
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Terminology

            <p>Applying a mutation to some code creates a *mutant*.</p>
            <p>If test passes - mutant has *survived*.</p>
            <p>If test fails - mutant is *killed*.</p>
          </script>
        </section>

        <section data-background="#6FAE66">
          <h2 style="color: #b82500">
            Failing is the new passing
          </h2>
        </section>

        <section data-markdown>
          <script type="text/template">
            Tests’ effectiveness is measured by number of killed mutants
            by your test suite.
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### What if mutant survives
            * Simplify your code
            * Add additional tests
            <br><br>
            * TDD - minimal amount of code to pass the test
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Hunting tips

            ```ruby
            # Avoid literals
            posts[0] => posts.first

            # Don’t overuse syntactic constructs
            ::User => User

            # Don’t pass literal defaults
            num.to_s(10) => num.to_s
            ```
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Challenges
            * High computation cost - slow
            * Equivalent mutants - false negatives
            * Infinite loops
          </script>
        </section>

        <section data-markdown class="code-blocks">
          <script type="text/template">
            ### Equivalent mutations

            ```ruby
            # Original
            i = 0
            while i != 10
              do_something
              i += 1
            end
            ```

            ```ruby
            # Mutant
            i = 0
            while i < 10
              do_something
              i += 1
            end
            ```
          </script>
        </section>

        <section data-markdown class="code-blocks">
          <script type="text/template">
            ### Infinite Runtime

            ```ruby
            # Original
            while expression
              do_something
            end
            ```

            ```ruby
            # Mutation
            while true
              do_something
            end
            ```
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Use timeouts

            ```ruby
            config.around(:each) do |example|
              Timeout.timeout(2) do
                example.run
              end
            end
            ```
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Mutant
            * Active project
            * Good reporting
            * Only works with **rspec**
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### How

            *Can’t just do*
            `String#gsub`
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### How

            Mutant uses a pure Ruby *parser*<br>
            and an *unparser* to do its magic.

            AST:

            ```ruby
            p Parser::CurrentRuby.parse("2 + 2")
            # (send
            #   (int 2) :+
            #   (int 2))
            ```
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Mutations
            - Literal / primitive and compound
            - Statement deletion
            - Conditional
            - Binary connective replacement
            - Argument deletion / rename / swap
            - Unary operator exchange
            - Bitwise
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Test-Selection

            *“Longest rspec example group<br>
            descriptions’ prefix match”*

          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Test-Selection

            ```sh
            mutant --include lib --require bar --use rspec Foo::Bar#baz
            ```

            1. Foo::Bar#baz
            2. Foo::Bar
            3. Foo
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            # Demo
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Disadvantages
            * Slow - cannot be part of TDD rhythm
            * May be very noisy
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Summary
            * Normal code coverage highlights<br>
              code that is definitely *not* tested
            * Mutation testing highlights code<br>
              that definitely *is* tested
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ## Thanks!
            ### Q & A
          </script>
        </section>

        <section data-background="./images/afterparty.png"></section>
      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: true,
        history: true,
        center: true,
        width: 1400,

        theme: Reveal.getQueryHash().theme || 'vt', // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/fade/none

        // Parallax scrolling
        // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
        // parallaxBackgroundSize: '2100px 900px',

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.min.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
