<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Can you trust your tests?</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/tomorrow-night.css">

    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
      if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
      }
    </script>
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <section data-markdown>
          <script type="text/template">
            # Can you trust your tests?

            <img src="./images/vilnius-rb.png" width=160
              style="margin: 80px 10px -20px 0"/>
            <span class="who">
              2015 Vaidas Pilkauskas & Tadas Ščerbinskas
            </span>
          </script>
        </section>

        <section>
          <div>
            <div class="box right">
              Vaidas Pilkauskas
              @liucijus
            </div>
            <div class="box left">
              Tadas Ščerbinskas
              @tadassce
            </div>
          </div>
        </section>

        <section data-markdown>
          <script type="text/template">
            ## Agenda
            * Test code quality
            * Mutation testing
            * PIT - mutation testing for Java
          </script>
        </section>

        <section>
          <h3>Prod vs. Test code quality</h3>

          <p style="color: #111">
            Code has bugs.<br>
            Tests are code.<br>
            Tests have bugs.
          </p>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Prod vs. Test code quality

            Code has bugs.<br>
            Tests are code.<br>
            Tests have bugs.
          </script>
        </section>

        <section data-background="./images/who_watches_the_watchmen.jpg">
        </section>

        <section data-markdown>
          <script type="text/template">
            <aside class="notes">
             should discuss two aspects: test specification and code quality,
             list is only of test specification qualifiers
            </aside>

            ### Test Quality
            * Readable
            * Focused
            * Concise
            * Well named

          </script>
        </section>

        <section data-markdown class="coverage">
          <script type="text/template">
            > "Program testing can be used to show the presence of bugs, but never to show their absence!"
            <br>
            <a>- Edsger W. Dijkstra</a>
          </script>
        </section>

        <section data-markdown data-background="./images/monkey.jpg">
          <script type="text/template">
            <!-- http://www.chimpsanctuarynw.org/blog/wp-content/uploads/2009/03/negra-covered-in-pink-blanket-front-room_web_mg_8161.jpg -->
            ### Code coverage
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Types of code coverage
            * Instructions (C0 Coverage)
            * Branches (C1 Coverage)
            * Cyclomatic Complexity
            * Lines
            * Methods
            * Classes
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Line

            ```java
            boolean doFoo(boolean arg) {
              return arg ? "a" : "b";
            }
            ```

            ```java
            assertThat(a.doFoo(true), is("a"));
            ```

            100% line coverage. No test for "b".
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Line coverage completeness
            Java source:
            ```java
            System.out.println("foobar");
            ```
            Bytecode:
            ```bytecode
            GETSTATIC java/lang/System.out : Ljava/io/PrintStream;
            LDC "foobar"
            INVOKEVIRTUAL java/io/PrintStream.println (Ljava/lang/String;)V
            ```
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Branch

            ```java
            boolean doFoo(boolean arg) {
              return arg ? "a" : "b";
            }
            ```

            ```java
            assertThat(a.doFoo(true), is("a"));
            assertThat(a.doFoo(false), is("b"));
            ```

            100% branch coverage
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Java Coverage runners
            * JaCoCo
            * Clover
            * Cobertura
            * EMMA (discontinued, works only up to Java 7)
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            # Demo
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Can you trust 100% coverage?
            * Code coverage can only show what is *not* tested
            * 100% code coverage for interpreted languages is kind of like full compilation
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Code coverage can be gamed:
            * On purpose
            * By accident
          </script>
        </section>

        <section data-markdown data-background="./images/all_tests_pass.jpg">
          <!-- https://twitter.com/bloerwald/status/448415935926255618 -->
          <script type="text/template">
            #### SUCCESS: 26/26 (100%) Tests passed
          </script>
        </section>

        <section data-background="./images/crowrilla.jpg">
          <h3 style="color: #e7ad52">
            Mutation testing
          </h3>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Mutation testing
            Changes your program code and<br>
            expects your tests to fail.
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Terminology

            <p>Applying a mutation to some code creates a *mutant*.</p>
            <p>If test passes - mutant has *survived*.</p>
            <p>If test fails - mutant is *killed*.</p>
          </script>
        </section>

        <section data-background="#6FAE66">
          <h2 style="color: #b82500">
            Failing is the new passing
          </h2>
        </section>

        <section data-markdown>
          <script type="text/template">
            Tests’ effectiveness is measured by number of killed mutants
            by your test suite.
          </script>
        </section>

        <section data-markdown data-background="./images/hacker.png">
          <script type="text/template">
            <br><br><br><br><br>
            <span class="orange">
              **It’s like hiring a white-hat hacker to try to break into
              your server and making sure you detect it.**
            </span>
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### What if mutant survives
            * Simplify your code
            * Add additional tests
            <br><br>
            * TDD - minimal amount of code to pass the test
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Challenges
            * High computation cost - slow
            * Equivalent mutants - false negatives
            * Infinite loops
          </script>
        </section>

        <section data-markdown class="code-blocks">
          <script type="text/template">
            ### Equivalent mutations

            ```java
            // Original
            int i = 0;
            while (i != 10) {
              doSomething();
              i += 1;
            }
            ```

            ```java
            // Mutant
            int i = 0;
            while (i < 10) {
              doSomething();
              i += 1;
            }
            ```
          </script>
        </section>

        <section data-markdown class="code-blocks">
          <script type="text/template">
            ### Infinite Runtime

            ```java
            // Original
            while (expression)
              doSomething();
            ```

            ```java
            // Mutation
            while (true)
              doSomething();
            ```
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### PIT
            * Active project
            * Good reporting
            * Does not work with Scala
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### How

            *Won't go far with naive approach using*
            `String.replace`
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Source code manipulation
            #### Pros
            * A large range of mutations can be generated this way
            * Mutations can closely mimic the types of error a programmer might make
            * The mutations made can be clearly described and understood

            #### Cons
            * Source based mutators are generally harder to integrate into a build
            * Generating mutations in this way is relatively slow
            * Mutants must be written to disk, limiting the methods by which they can be inserted
            * In theory a mutant class could be accidentally released
          </script>
        </section>

        <section>
          <script type="text/template">
            ### Byte code manipulation
            #### Pros
            * Generally much faster
            * Generally easier to integrate into a build
            * Can potentially create mutants without access to source files
            * Same mutation operators can in theory work for other JVM languages

            #### Cons
            * More difficult to develop mutation operators this way
            * Mutations are divorced from the source code and may not be representative of errors a programmer would make
            * Can be hard to describe / explain the mutations that must work roud intricacies of the JVM
          </script>
        </section>
        <section data-markdown>
          <script type="text/template">
            ### How PIT does it?

            PIT uses ASM to generate mutations

          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Mutations
            #### Activated by default
            - Conditionals Boundary Mutator
            - Increments Mutator
            - Invert Negatives Mutator
            - Math Mutator
            - Negate Conditionals Mutator
            - Return Values Mutator
            - Void Method Calls Mutator
            #### Deactivated by default
            - Constructor Calls Mutator
            - Inline Constant Mutator
            - Non Void Method Calls Mutator
            - Remove Conditionals Mutator
            - Experimental Member Variable Mutator
            - Experimental Switch Mutator
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Test-Selection
            * Line coverage
            * Test execution speed
            * Test naming convention
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            # Demo
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
          ### Running PIT
          * Command line tool
          * Maven
          * Ant
          * Sbt. But useful only for Java :(
          * Gradle
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### PIT supports many mocking frameworks
            * Mockito
            * EasyMock
            * JMock
            * PowerMock
            * JMockit
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
          ### Maven example
          ```bash
          mvn org.pitest:pitest-maven:mutationCoverage
          ```

          With SCM plugin
          ```bash
          mvn org.pitest:pitest-maven:scmMutationCoverage \
           -Dinclude=ADDED,UNKNOWN -DmutationThreshold=85
          ```
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
          ### Dependency distance
          How far the test is from the mutated class
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
          ### Limit mutation number per class
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
          ### Activate/deactivate mutators
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
          ### Extension points
          Uses Java Service Provider - SPI
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
          ### Output
          HTML (default), XML, CSV
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Disadvantages
            * Slow - cannot be part of TDD rhythm
            * May be very noisy
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
          ### Does Mutation Testing Work?
          > In practice, if the software contains a fault, there will usually be a set of mutants that can only be killed by a test case that also detects that fault. Geist et. al., “Estimation and Enhancement of Real-time Software Reliability through Mutation Analysis,” 1992
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ### Summary
            * *Code coverage* highlights<br>
              code that is definitely *not* tested
            * *Mutation testing* highlights code<br>
              that definitely *is* tested
            * For non equivalent mutations, good test<br>
              suite should work the same as a hash function
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
            ## Thanks!
            ### Q & A
          </script>
        </section>

        <section data-markdown class="credits">
          <script type="text/template">
            ###### Pictures
            - http://crazy-monkeeey.deviantart.com/art/Who-watches-the-Watchmen-344523349
            - http://www.chimpsanctuarynw.org/blog/wp-content/uploads/2009/03/negra-covered-in-pink-blanket-front-room_web_mg_8161.jpg
            - https://twitter.com/bloerwald/status/448415935926255618
            - http://www.smosh.com/smosh-pit/photos/12-more-bizarre-mutant-animals
            - https://tbgsecurity.com/the-history-of-hacking-timeline-of-hacking-techniques-infographic/
          </script>
        </section>
      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: true,
        history: true,
        center: true,
        width: 1400,

        theme: Reveal.getQueryHash().theme || 'vt', // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/fade/none

        // Parallax scrolling
        // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
        // parallaxBackgroundSize: '2100px 900px',

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.min.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
